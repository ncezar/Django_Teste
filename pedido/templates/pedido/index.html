{% load staticfiles %}
{{ form.media.css }}
{{ form.media.js }}
<html>
    <head>
        <title>Pedidos Mercos</title>
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    </head>
    <body>
      <div class="page-header">
            <h1><a href="/">Cadastro</a></h1>
      </div>


      <form id="CadastroForm" method ='POST' data-url="{% url 'load_preco' %}" novalidate> {% csrf_token %}
         {{ form.as_p }}

         {% if messages %}

          {% for message in messages %}
            <p{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</p>
          {% endfor %}

         {% endif %}

         <input type='submit' value='Enviar'/>
         <a href="{% url 'index' %}"><input type =button value='Novo'></a>
         <br> <br>
         <a href="/"><input type =button value='Home'></a>

     </form>

     <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
     <script>
        $("#id_item").change(function () {
            var url = $("#CadastroForm").attr("data-url");  // pega a url enviada no form (load-preco)
            console.log('URL ',url)
            var item = $(this).val();  // pega o valor do input html do item
            //console.log('Mãe to na funcao again ', item)
            $.ajax({                       // AJAX request
              url: url,                    // chama a url
              data: {
                'item': item      // adiciona o item aos parametros de GET

              },
              dataType: 'json',
              success: function (data) {   // data é o retorno da view load-preco
                //$("#preco_unitario").html(data);
                console.log('Mãe to na funcao dos dados ', data['preco_unitario'])
                $('#id_preco_unitario').val(data['preco_unitario'])

                 // replace the contents of the city input with the data that came from the server
              }
            });

          });
        </script>
        <script>//script para mostrar a rentabilidade, ajax faz request para view load-rentabilidade quando o item html preco_unitario muda no formulario
          $("#id_preco_unitario").change(function () {
            var preco_unitario = $(this).val();
            var item = $("#id_item").val();
            console.log('Item:', item)
            $.ajax({
              url: '/ajax/load-rentabilidade/',
              data: {
                'item': item,
                'preco_unitario': preco_unitario
              },
              dataType: 'json',
              success: function (data) {
                if (data.rent_otima) {
                  alert("Rentabilidade ótima.");
                }
                if (data.rent_boa){
                  alert("Rentabilidade boa.");
                }
              }
            });

          });
        </script>


  </body>
</html>
